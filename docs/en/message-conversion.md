# Message Conversion

> [!NOTE]
>
> **Feature Overview**: Provides practical message conversion functionalities.
>
> **Prerequisites**: Understand LangChain's [Message](https://docs.langchain.com/oss/python/langchain/messages).
>
> **Estimated Reading Time**: 3 minutes

## Merge Reasoning Content into Final Response

Used to merge reasoning content (`reasoning_content`) into the final response (`content`).

Specifically:

- `convert_reasoning_content_for_ai_message`: Merges reasoning content from AIMessage into the content field (for model's invoke and ainvoke)
- `convert_reasoning_content_for_chunk_iterator`: Merges reasoning content from streaming responses into the content field (for model's stream)
- `aconvert_reasoning_content_for_chunk_iterator`: Asynchronous version of `convert_reasoning_content_for_chunk_iterator`, for asynchronous streaming (for model's astream)

Parameters:

- `model_response`: AI message response returned by the model (could be AIMessage or an iterator of AIMessageChunk)
- `think_tag`: Tuple containing the start and end tags for reasoning content (defaults to `<think></think>`)

Usage Example:

```python
from typing import cast
from langchain_dev_utils.message_convert import (
    convert_reasoning_content_for_ai_message,
    convert_reasoning_content_for_chunk_iterator,
)
from langchain_core.messages import AIMessage


response = model.invoke("Hello")
converted_response = convert_reasoning_content_for_ai_message(
    cast(AIMessage, response), think_tag=("<start>", "<end>")
)
print(converted_response.content)

for chunk in convert_reasoning_content_for_chunk_iterator(
    model.stream("Hello"), think_tag=("<start>", "<end>")
):
    print(chunk.content, end="", flush=True)
```

## Merge Streaming Output Chunks

Provides utility functions to merge multiple AIMessageChunks generated by streaming output into a single AIMessage.
Core function:

- `merge_ai_message_chunk`: Merge AI message chunks

Supported parameters:

- `chunks`: List of AI message chunks

Usage Example:

```python
from langchain_dev_utils.message_convert import merge_ai_message_chunk

chunks = []
for chunk in model.stream("Hello"):
    chunks.append(chunk)

merged_message = merge_ai_message_chunk(chunks)
print(merged_message)
```

## Format List Content

Formats a list consisting of Documents, Messages, or strings into a single text string.

Core function:

- `format_sequence`: Format messages

Supported parameters:

- `inputs`: List containing any of the following types:
  - `langchain_core.messages`: HumanMessage, AIMessage, SystemMessage, ToolMessage
  - `langchain_core.documents.Document`
  - `str`
- `separator`: String used to join the contents, defaults to `"-"`.
- `with_num`: If `True`, adds numeric prefixes to each item (e.g., `"1. Hello"`), defaults to `False`.

Usage Example:

```python
from langchain_core.documents import Document
from langchain_core.messages import AIMessage
from langchain_dev_utils.message_convert import format_sequence

formatted1 = format_sequence(
    [
        AIMessage(content="Hello1"),
        AIMessage(content="Hello2"),
        AIMessage(content="Hello3"),
    ]
)
print(formatted1)

formatted2 = format_sequence(
    [
        Document(page_content="content1"),
        Document(page_content="content2"),
        Document(page_content="content3"),
    ],
    separator="\n",
)
print(formatted2)

formatted3 = format_sequence(
    [
        "str1",
        "str2",
        "str3",
    ],
    separator="\n",
    with_num=True,
)
print(formatted3)
```

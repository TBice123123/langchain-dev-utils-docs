# 最佳实践指南

## 编排函数选择

### 串行编排

当任务具有明确的、不可颠倒的先后顺序时，应采用串行编排。这种模式适用于工作流中每一步都依赖于前一步的输出或结果的场景。例如，一个流程可能需要先由“分析师智能体”进行问题诊断，然后由“规划师智能体”制定行动计划，最后由“执行者智能体”完成任务。这种顺序执行流程确保了逻辑的严谨性和步骤的连贯性，可以使用 `sequential_pipeline` 实现。

### 并行编排

当多个子任务相互独立，可以同时处理以缩短总执行时间时，应采用并行编排。这种方式能显著提升系统效率，尤其适用于需要从多个不同来源收集信息或执行多个独立操作的聚合型任务。例如，同时调用天气服务、日历服务和新闻服务来生成一份晨间简报。由于这些任务互不干扰，并行处理可以最大化资源利用率，可以使用 `parallel_pipeline` 实现。

## 多智能体系统中的智能体并行编排

在更复杂的多智能体系统中，并行编排的威力通过 `branches_fn` 得到了进一步释放。它允许系统根据实时状态和上下文，动态地、有选择地并行执行任务。

这种模式的核心思想是引入一个“协调智能体”（或称“路由智能体”）。该智能体不直接执行具体任务，而是负责理解用户意图，将复杂请求分解为多个更小的、可并行的子任务，然后将这些子任务精准地分发给最合适的“执行智能体”。

**常见应用场景包括：**

- **任务分解与分发**：协调智能体分析用户查询，如“帮我规划一次周末旅行”，并将其分解为“查询天气”、“搜索酒店”、“推荐景点”等子任务，同时分发给不同的专业智能体处理。
- **条件性激活**：系统可以根据输入内容动态决定需要哪些智能体参与。例如，如果用户问题中包含财务关键词，则激活财务分析智能体；如果包含技术术语，则激活技术支持智能体，实现智能按需调度。
- **冗余与验证**：对于关键任务，可以同时将请求发送给多个不同策略的智能体，然后通过一个“评审智能体”来综合比较它们的结果，以提高最终答案的准确性和可靠性。

通过这种灵活的编排方式，可以构建出既高效又智能的复杂自动化系统，能够优雅地处理多方面、多层次的复杂需求。
